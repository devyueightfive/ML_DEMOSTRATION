# gender_project

Данный проект представляет собой демонстрационный сервис по предсказанию пола людей на основе логов.

Цель. Сайты для повышения вероятности совершения покупок предлагают рекомендации, которые, вероятно, заинтересуют посетителя. Для увеличения качества рекомендации иногда важно знать пол посетителя сайта, который, возможно играет ключевую роль в построении рекомендаций для данного портала. Так как посетители сайта при регистрации иногда не указывают свой пол, возможно предсказать вероятный пол по поведению пользователя на сайте.

Данные:
Логи представляют собой записи сессий посещения некоторого сайта.
Логи состоят из 2х таблиц. 
Первая представляет собой набор сессий и названия категорий товаров, которые рассматривал посетититель.
Вторая представляет логи сессий с временными признаками и генедерными признаками посетителя.

Данные представлены из источника : https://relational.fit.cvut.cz/dataset/FTP

Путь поиска решения.
Доступ к данным получается через sqlalchemy.
На основе двух таблиц генерятся признаки. Смотрите файл '/notebooks/1-YU-GENDER_MODEL.ipynb'
Строится одна таблица. Разбивается на 2 части: тренировочную и валидационную. Тестируются разные классификаторы по roc-auc метрики. Выбор пал на данную метрику в следствие несбалансированности данных.  Выбирается в качестве основного классификатора RandomForest. 
Модель строится, как паплайн и сохраняется в формате pkl.

Для демонстрации работы модели используется веб-сервис. Который на rest запросы, выдает json-ответы.
Код для запросов выделен в модуль database_requests.py

**Запрос по предсказанию пола данного пользователя.**

URL : http://127.0.0.1:5000/predict/u25000
json response: {"PREDICTION":"male","SESSION_ID":"u25000"}

в случае неверных входных данных (нет статистики по данному пользователю)

URL : http://127.0.0.1:5000/predict/u00000
json response: {"PREDICTION":"UNKNOWN_SESSION_ID","SESSION_ID":"u00000"}


**Дополнительный запрос по статистике из базы данных. Выдает ответ, сколько раз посещал данную категорию данный пользователь. Не использует предиктивную модель.**

URL : http://127.0.0.1:5000/count/u10003/B00002
json response: {"CATEGORY":"B00002","COUNT":12,"SESSION_ID":"u10003"}

в случае отсутствия данных по категории

URL : http://127.0.0.1:5000/count/u10003/000000
json response: {"CATEGORY":"000000","COUNT":0,"SESSION_ID":"u10003"}

## Предустановка среды для демонстрации работы

1. ```
   sudo apt-get install python3-dev default-libmysqlclient-dev build-essential
   ``` 

2. ```
   conda env create -f env.yaml
   ```

3. activate the new environment with
   ```
   conda activate gender_project
   ```
4. start app
   ```
   python3 app.py
   ```
5. check work with rest requests in browser
   
   http://127.0.0.1:5000/predict/u25000
   
6. remove

   ```
   conda env remove -n gender_project
   ```